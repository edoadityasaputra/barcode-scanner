<!DOCTYPE html>
<html lang="id">
  <head>
    <meta charset="UTF-8" />
    <title>Barcode Scanner</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://unpkg.com/html5-qrcode"></script>
  </head>
  <body style="text-align:center; font-family:Arial">
    <h2>ðŸ“· Scan Barcode / QR Code</h2>
    <p>Arahkan kamera ke barcode untuk membuka link</p>
    <div id="reader" style="width:300px; margin:auto;"></div>

    <p id="result" style="font-weight:bold; color:green; margin-top:10px;"></p>

    <!-- Tombol aksi -->
    <div id="buttons" style="margin-top:15px; display:none;">
      <button id="btnKirim" style="padding:10px 20px; font-size:16px; background-color:#2a9d8f; color:white; border:none; border-radius:8px; cursor:pointer; margin-right:10px;">
        Kirim
      </button>
      <button id="btnBatal" style="padding:10px 20px; font-size:16px; background-color:#e76f51; color:white; border:none; border-radius:8px; cursor:pointer;">
        Batal
      </button>
    </div>

    <script>
      let lastResult = "";
      const html5QrCode = new Html5Qrcode("reader");

      function startScanner() {
        document.getElementById("result").innerText = "";
        document.getElementById("buttons").style.display = "none";
        html5QrCode
          .start(
            { facingMode: "environment" },
            { fps: 10, qrbox: 250 },
            onScanSuccess
          )
          .catch((err) => {
            console.error("Gagal memulai kamera:", err);
            document.getElementById("result").innerText = "Gagal mengakses kamera!";
          });
      }

      function onScanSuccess(decodedText) {
        html5QrCode.stop();
        lastResult = decodedText;
        document.getElementById("result").innerText = "Barcode terbaca!";
        document.getElementById("buttons").style.display = "block";
      }

      document.getElementById("btnKirim").addEventListener("click", function() {
        if (lastResult) {
          window.location.href = lastResult;
        }
      });

      document.getElementById("btnBatal").addEventListener("click", function() {
        // Kembali ke mode scan
        startScanner();
      });

      // Mulai pertama kali
      startScanner();
    </script>
  </body>
</html>
